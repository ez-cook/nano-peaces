# Composition Patterns — shadcn/ui

## cn() Utility

Merges Tailwind classes safely. Handles conflicts (e.g., `bg-red-500` + `bg-blue-500` → last wins).

```tsx
import { cn } from '@/lib/utils'

// Basic: conditional classes
;<div className={cn('rounded-lg border p-4', isActive && 'border-primary bg-primary/5')} />

// Extending a component
function MyButton({ className, ...props }) {
  return <Button className={cn('w-full', className)} {...props} />
}
```

**Implementation** (auto-generated by shadcn init):

```tsx
// lib/utils.ts
import { clsx, type ClassValue } from 'clsx'
import { twMerge } from 'tailwind-merge'

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
```

## asChild Prop (Radix Slot)

Renders the child element directly instead of the wrapper. Essential for polymorphic rendering.

```tsx
// Without asChild: renders <button><a>...</a></button> ❌ invalid HTML
<Button><Link href="/">Home</Link></Button>

// With asChild: renders <a class="button-styles">Home</a> ✅
<Button asChild>
  <Link href="/">Home</Link>
</Button>
```

Works with: Button, DialogTrigger, DropdownMenuTrigger, NavigationMenuLink, any Radix trigger.

## data-icon Convention

Icons inside buttons/menu items need `data-icon` for correct spacing:

```tsx
<Button>
  <Plus data-icon="inline-start" />   {/* adds margin-end */}
  Add Item
</Button>

<Button>
  Next
  <ArrowRight data-icon="inline-end" /> {/* adds margin-start */}
</Button>
```

## cva() — Creating Variant Systems

When building custom components with variants (like shadcn's Button):

```tsx
import { cva, type VariantProps } from 'class-variance-authority'

const badgeVariants = cva(
  'inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold',
  {
    variants: {
      variant: {
        default: 'border-transparent bg-primary text-primary-foreground',
        secondary: 'border-transparent bg-secondary text-secondary-foreground',
        destructive: 'border-transparent bg-destructive text-destructive-foreground',
        outline: 'text-foreground',
      },
    },
    defaultVariants: { variant: 'default' },
  },
)

interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return <div className={cn(badgeVariants({ variant }), className)} {...props} />
}
```

## Extending Components

```tsx
import { Button, type ButtonProps } from '@/components/ui/button'
import { cn } from '@/lib/utils'
import { forwardRef } from 'react'

const SubmitButton = forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, children, ...props }, ref) => (
    <Button ref={ref} type="submit" className={cn('w-full', className)} {...props}>
      {children ?? 'Submit'}
    </Button>
  ),
)
SubmitButton.displayName = 'SubmitButton'
```

## Anti-patterns

- ❌ Don't merge classes with template literals — use `cn()`
- ❌ Don't wrap interactive elements in Button — use `asChild`
- ❌ Don't skip `forwardRef` when wrapping components — breaks composition
- ❌ Don't create variants without `cva()` — use it for consistency
